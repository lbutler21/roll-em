<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>5e D&D Character Sheet</title>
  <script>
    (function(){try{var t=localStorage.getItem('dice-proj-theme');if(t==='light')document.documentElement.setAttribute('data-theme','light');}catch(e){}})();
  </script>
  <link rel="stylesheet" href="styles.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Source+Sans+3:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
</head>
<body>
  <div class="app">
    <div id="backdoor-overlay" class="backdoor-overlay hidden">
      <div class="backdoor-box">
        <label>Secret <input type="password" id="backdoor-secret" placeholder="Enter backdoor secret" autocomplete="off" /></label>
        <button type="button" id="backdoor-submit" class="btn btn-primary">Unlock</button>
        <p id="backdoor-error" class="backdoor-error hidden"></p>
      </div>
    </div>
    <div id="admin-panel" class="admin-panel hidden">
      <div class="admin-panel-inner">
        <h1 class="admin-title">Admin</h1>
        <p><a href="#" id="admin-back-to-sheet" class="admin-link">← Back to character sheet</a></p>
        <section class="admin-section">
          <h2>Users</h2>
          <div id="admin-users-list" class="admin-table-wrap">Loading…</div>
        </section>
        <section class="admin-section">
          <h2>All characters</h2>
          <div id="admin-characters-list" class="admin-table-wrap">Loading…</div>
        </section>
      </div>
    </div>
    <div id="landing-page" class="landing-page">
      <button type="button" id="landing-theme-toggle" class="btn btn-ghost landing-theme-btn no-print" title="Switch to light mode" aria-label="Theme">☀</button>
      <div class="landing-inner">
        <h1 class="landing-title">5e D&D Character Sheet</h1>
        <p class="landing-subtitle">Create and manage your characters</p>
        <button type="button" id="btn-start-now" class="btn btn-primary btn-landing-cta">Start now</button>
        <div class="landing-auth-links">
          <button type="button" id="landing-btn-login" class="btn btn-primary">Log in</button>
          <button type="button" id="landing-btn-register" class="btn btn-primary">Register</button>
        </div>
      </div>
    </div>
    <div id="main-app" class="hidden">
    <!-- Character banner -->
    <header class="char-banner">
      <div class="char-banner-main">
        <div class="char-banner-left">
          <button type="button" id="btn-create" class="btn btn-primary" title="Create new character">Create Character</button>
          <div class="char-identity">
            <h1 id="banner-name" class="char-name">Character Sheet</h1>
            <p id="banner-subtitle" class="char-subtitle">—</p>
          </div>
        </div>
        <div class="char-banner-right">
          <span id="auth-status" class="auth-status">
            <button type="button" id="btn-login" class="btn btn-primary">Log in</button>
            <button type="button" id="btn-register" class="btn btn-primary">Register</button>
          </span>
          <span id="auth-user" class="auth-user hidden">
            <span id="auth-username"></span>
            <button type="button" id="btn-logout" class="btn btn-banner">Log out</button>
          </span>
          <button type="button" id="btn-manage" class="btn btn-banner" title="Manage character">Manage</button>
          <button type="button" id="btn-theme-toggle" class="btn btn-ghost btn-theme-toggle no-print" title="Switch to light mode" aria-label="Theme">☀</button>
        </div>
      </div>
      <div class="char-banner-bar">
        <span class="xp-label">LVL <span id="banner-level">1</span></span>
        <div class="xp-progress">
          <div id="xp-bar" class="xp-bar" style="width: 0%"></div>
        </div>
        <span class="xp-next">LVL 2</span>
      </div>
      <div class="char-banner-actions">
        <button type="button" id="btn-reference" class="btn btn-ghost" title="Open D&D Beyond reference (spells, equipment, rules)">Reference</button>
        <button type="button" id="btn-new" class="btn btn-ghost">Blank</button>
        <button type="button" id="btn-load" class="btn btn-ghost btn-gated-by-auth" title="Log in to load characters" data-title-logged-in="Load character">Load</button>
        <button type="button" id="btn-save" class="btn btn-ghost btn-gated-by-auth" title="Log in to save" data-title-logged-in="Save to server">Save</button>
        <button type="button" id="btn-save-pdf" class="btn btn-ghost no-print" title="Print or save as PDF">Save as PDF</button>
        <span id="save-status" class="save-status"></span>
      </div>
    </header>

    <!-- Character Builder Wizard (D&D Beyond style) -->
    <div id="builder-modal" class="modal builder-modal hidden">
      <div class="builder-content">
        <div class="builder-header">
          <h2>Character Builder</h2>
          <div class="builder-steps">
            <span class="step" data-step="1">1. Basics</span>
            <span class="step" data-step="2">2. Class</span>
            <span class="step" data-step="3">3. Race</span>
            <span class="step" data-step="4">4. Abilities</span>
            <span class="step" data-step="5">5. Background</span>
            <span class="step" data-step="6">6. Review</span>
          </div>
        </div>
        <div class="builder-body">
          <div id="builder-step-1" class="builder-step">
            <h3>Character Basics</h3>
            <label>Character Name <input type="text" id="builder-name" placeholder="Enter name" /></label>
            <label>Starting Level <input type="number" id="builder-level" min="1" max="20" value="1" /></label>
          </div>
          <div id="builder-step-2" class="builder-step hidden">
            <h3>Choose Your Class</h3>
            <p class="builder-hint">Your class defines your character's role and abilities.</p>
            <div id="builder-class-grid" class="builder-option-grid"></div>
          </div>
          <div id="builder-step-3" class="builder-step hidden">
            <h3>Choose Your Race</h3>
            <p class="builder-hint">Your race provides special traits and abilities.</p>
            <div id="builder-race-grid" class="builder-option-grid"></div>
          </div>
          <div id="builder-step-4" class="builder-step hidden">
            <h3>Ability Scores</h3>
            <p class="builder-hint">Choose how to determine your ability scores.</p>
            <div class="ability-method-row">
              <label class="method-option"><input type="radio" name="abilityMethod" value="standard" checked /> Standard Array (15, 14, 13, 12, 10, 8)</label>
              <label class="method-option"><input type="radio" name="abilityMethod" value="pointbuy" /> Point Buy (27 points)</label>
              <label class="method-option"><input type="radio" name="abilityMethod" value="roll" /> Roll 4d6 (drop lowest)</label>
            </div>
            <div id="ability-assign-area" class="ability-assign-area">
              <p class="ability-instruction">Assign your scores. <span id="ability-suggest-hint"></span></p>
              <div class="ability-assign-grid">
                <label>STR <input type="number" id="builder-str" min="8" max="20" value="10" class="ability-assign-input" /></label>
                <label>DEX <input type="number" id="builder-dex" min="8" max="20" value="10" class="ability-assign-input" /></label>
                <label>CON <input type="number" id="builder-con" min="8" max="20" value="10" class="ability-assign-input" /></label>
                <label>INT <input type="number" id="builder-int" min="8" max="20" value="10" class="ability-assign-input" /></label>
                <label>WIS <input type="number" id="builder-wis" min="8" max="20" value="10" class="ability-assign-input" /></label>
                <label>CHA <input type="number" id="builder-cha" min="8" max="20" value="10" class="ability-assign-input" /></label>
              </div>
              <div class="ability-method-actions">
                <button type="button" id="btn-apply-standard" class="btn btn-ghost btn-sm">Use Standard Array</button>
                <button type="button" id="btn-roll-abilities" class="btn btn-ghost btn-sm">Roll 4d6</button>
              </div>
              <p id="pointbuy-status" class="pointbuy-status hidden">Points remaining: <span id="pointbuy-remaining">27</span></p>
            </div>
          </div>
          <div id="builder-step-5" class="builder-step hidden">
            <h3>Choose Your Background</h3>
            <p class="builder-hint">Your background represents your life before adventuring.</p>
            <div id="builder-background-grid" class="builder-option-grid"></div>
          </div>
          <div id="builder-step-6" class="builder-step hidden">
            <h3>Review & Complete</h3>
            <div id="builder-summary" class="builder-summary"></div>
            <p class="builder-hint">Click Complete to apply these choices to your character sheet.</p>
          </div>
        </div>
        <div class="builder-footer">
          <button type="button" id="btn-builder-back" class="btn btn-ghost">Back</button>
          <button type="button" id="btn-builder-next" class="btn btn-primary">Next</button>
          <button type="button" id="btn-builder-complete" class="btn btn-primary hidden">Complete</button>
          <button type="button" id="btn-builder-cancel" class="btn btn-ghost">Cancel</button>
        </div>
      </div>
    </div>

    <main class="sheet">
      <!-- Left column: Abilities, Saves, Skills, Senses -->
      <aside class="sheet-left">
      <!-- Abilities -->
      <section class="card card-abilities">
        <h2>Abilities</h2>
        <div class="abilities-grid">
          <div class="ability-block">
            <span class="ability-label">STR</span>
            <input type="number" id="ability-str" min="1" max="30" value="10" class="ability-score" />
            <span class="ability-mod" id="mod-str">+0</span>
            <button type="button" class="roll-btn" data-ability="str" title="Roll d20 + modifier">d20</button>
          </div>
          <div class="ability-block">
            <span class="ability-label">DEX</span>
            <input type="number" id="ability-dex" min="1" max="30" value="10" class="ability-score" />
            <span class="ability-mod" id="mod-dex">+0</span>
            <button type="button" class="roll-btn" data-ability="dex">d20</button>
          </div>
          <div class="ability-block">
            <span class="ability-label">CON</span>
            <input type="number" id="ability-con" min="1" max="30" value="10" class="ability-score" />
            <span class="ability-mod" id="mod-con">+0</span>
            <button type="button" class="roll-btn" data-ability="con">d20</button>
          </div>
          <div class="ability-block">
            <span class="ability-label">INT</span>
            <input type="number" id="ability-int" min="1" max="30" value="10" class="ability-score" />
            <span class="ability-mod" id="mod-int">+0</span>
            <button type="button" class="roll-btn" data-ability="int">d20</button>
          </div>
          <div class="ability-block">
            <span class="ability-label">WIS</span>
            <input type="number" id="ability-wis" min="1" max="30" value="10" class="ability-score" />
            <span class="ability-mod" id="mod-wis">+0</span>
            <button type="button" class="roll-btn" data-ability="wis">d20</button>
          </div>
          <div class="ability-block">
            <span class="ability-label">CHA</span>
            <input type="number" id="ability-cha" min="1" max="30" value="10" class="ability-score" />
            <span class="ability-mod" id="mod-cha">+0</span>
            <button type="button" class="roll-btn" data-ability="cha">d20</button>
          </div>
        </div>
      </section>

      <!-- Saving throws -->
      <section class="card card-saves">
        <h2>Saving Throws</h2>
        <div class="saves-list">
          <label class="save-row"><input type="checkbox" id="save-str" /> STR <span id="save-mod-str">+0</span></label>
          <label class="save-row"><input type="checkbox" id="save-dex" /> DEX <span id="save-mod-dex">+0</span></label>
          <label class="save-row"><input type="checkbox" id="save-con" /> CON <span id="save-mod-con">+0</span></label>
          <label class="save-row"><input type="checkbox" id="save-int" /> INT <span id="save-mod-int">+0</span></label>
          <label class="save-row"><input type="checkbox" id="save-wis" /> WIS <span id="save-mod-wis">+0</span></label>
          <label class="save-row"><input type="checkbox" id="save-cha" /> CHA <span id="save-mod-cha">+0</span></label>
        </div>
      </section>

      <!-- Skills -->
      <section class="card card-skills">
        <h2>Skills</h2>
        <div class="skills-list">
          <label class="skill-row"><input type="checkbox" id="skill-acrobatics" /> <span class="skill-tooltip-trigger" data-skill="acrobatics">Acrobatics</span> <span class="skill-ability">(DEX)</span> <span id="skill-mod-acrobatics">+0</span> <button type="button" class="skill-roll" data-skill="acrobatics" data-ability="dex">Roll</button></label>
          <label class="skill-row"><input type="checkbox" id="skill-animalHandling" /> <span class="skill-tooltip-trigger" data-skill="animalHandling">Animal Handling</span> (WIS) <span id="skill-mod-animalHandling">+0</span> <button type="button" class="skill-roll" data-skill="animalHandling" data-ability="wis">Roll</button></label>
          <label class="skill-row"><input type="checkbox" id="skill-arcana" /> <span class="skill-tooltip-trigger" data-skill="arcana">Arcana</span> (INT) <span id="skill-mod-arcana">+0</span> <button type="button" class="skill-roll" data-skill="arcana" data-ability="int">Roll</button></label>
          <label class="skill-row"><input type="checkbox" id="skill-athletics" /> <span class="skill-tooltip-trigger" data-skill="athletics">Athletics</span> (STR) <span id="skill-mod-athletics">+0</span> <button type="button" class="skill-roll" data-skill="athletics" data-ability="str">Roll</button></label>
          <label class="skill-row"><input type="checkbox" id="skill-deception" /> <span class="skill-tooltip-trigger" data-skill="deception">Deception</span> (CHA) <span id="skill-mod-deception">+0</span> <button type="button" class="skill-roll" data-skill="deception" data-ability="cha">Roll</button></label>
          <label class="skill-row"><input type="checkbox" id="skill-history" /> <span class="skill-tooltip-trigger" data-skill="history">History</span> (INT) <span id="skill-mod-history">+0</span> <button type="button" class="skill-roll" data-skill="history" data-ability="int">Roll</button></label>
          <label class="skill-row"><input type="checkbox" id="skill-insight" /> <span class="skill-tooltip-trigger" data-skill="insight">Insight</span> (WIS) <span id="skill-mod-insight">+0</span> <button type="button" class="skill-roll" data-skill="insight" data-ability="wis">Roll</button></label>
          <label class="skill-row"><input type="checkbox" id="skill-intimidation" /> <span class="skill-tooltip-trigger" data-skill="intimidation">Intimidation</span> (CHA) <span id="skill-mod-intimidation">+0</span> <button type="button" class="skill-roll" data-skill="intimidation" data-ability="cha">Roll</button></label>
          <label class="skill-row"><input type="checkbox" id="skill-investigation" /> <span class="skill-tooltip-trigger" data-skill="investigation">Investigation</span> (INT) <span id="skill-mod-investigation">+0</span> <button type="button" class="skill-roll" data-skill="investigation" data-ability="int">Roll</button></label>
          <label class="skill-row"><input type="checkbox" id="skill-medicine" /> <span class="skill-tooltip-trigger" data-skill="medicine">Medicine</span> (WIS) <span id="skill-mod-medicine">+0</span> <button type="button" class="skill-roll" data-skill="medicine" data-ability="wis">Roll</button></label>
          <label class="skill-row"><input type="checkbox" id="skill-nature" /> <span class="skill-tooltip-trigger" data-skill="nature">Nature</span> (INT) <span id="skill-mod-nature">+0</span> <button type="button" class="skill-roll" data-skill="nature" data-ability="int">Roll</button></label>
          <label class="skill-row"><input type="checkbox" id="skill-perception" /> <span class="skill-tooltip-trigger" data-skill="perception">Perception</span> (WIS) <span id="skill-mod-perception">+0</span> <button type="button" class="skill-roll" data-skill="perception" data-ability="wis">Roll</button></label>
          <label class="skill-row"><input type="checkbox" id="skill-performance" /> <span class="skill-tooltip-trigger" data-skill="performance">Performance</span> (CHA) <span id="skill-mod-performance">+0</span> <button type="button" class="skill-roll" data-skill="performance" data-ability="cha">Roll</button></label>
          <label class="skill-row"><input type="checkbox" id="skill-persuasion" /> <span class="skill-tooltip-trigger" data-skill="persuasion">Persuasion</span> (CHA) <span id="skill-mod-persuasion">+0</span> <button type="button" class="skill-roll" data-skill="persuasion" data-ability="cha">Roll</button></label>
          <label class="skill-row"><input type="checkbox" id="skill-religion" /> <span class="skill-tooltip-trigger" data-skill="religion">Religion</span> (INT) <span id="skill-mod-religion">+0</span> <button type="button" class="skill-roll" data-skill="religion" data-ability="int">Roll</button></label>
          <label class="skill-row"><input type="checkbox" id="skill-sleightOfHand" /> <span class="skill-tooltip-trigger" data-skill="sleightOfHand">Sleight of Hand</span> (DEX) <span id="skill-mod-sleightOfHand">+0</span> <button type="button" class="skill-roll" data-skill="sleightOfHand" data-ability="dex">Roll</button></label>
          <label class="skill-row"><input type="checkbox" id="skill-stealth" /> <span class="skill-tooltip-trigger" data-skill="stealth">Stealth</span> (DEX) <span id="skill-mod-stealth">+0</span> <button type="button" class="skill-roll" data-skill="stealth" data-ability="dex">Roll</button></label>
          <label class="skill-row"><input type="checkbox" id="skill-survival" /> <span class="skill-tooltip-trigger" data-skill="survival">Survival</span> (WIS) <span id="skill-mod-survival">+0</span> <button type="button" class="skill-roll" data-skill="survival" data-ability="wis">Roll</button></label>
        </div>
      </section>

      <!-- Passive scores & senses -->
      <section class="card card-senses">
        <h2>Senses</h2>
        <div class="senses-list">
          <div class="sense-row"><span class="sense-label">Passive Perception</span><span id="passive-perception" class="sense-value">10</span></div>
          <div class="sense-row"><span class="sense-label">Passive Investigation</span><span id="passive-investigation" class="sense-value">10</span></div>
          <div class="sense-row"><span class="sense-label">Passive Insight</span><span id="passive-insight" class="sense-value">10</span></div>
        </div>
      </section>

      <!-- Tools & Languages -->
      <section class="card card-tools-langs">
        <h2>Tools & Languages</h2>
        <div class="tools-langs-list">
          <label class="tl-row"><span class="tl-label">Tools</span><input type="text" id="toolProficiencies" placeholder="e.g. Thieves' tools, Smith's tools" /></label>
          <label class="tl-row"><span class="tl-label">Languages</span><input type="text" id="languages" placeholder="e.g. Common, Elvish" /></label>
        </div>
      </section>
      </aside>

      <!-- Right column: Combat stats, HP, tabbed content -->
      <div class="sheet-right">
      <!-- Combat -->
      <section class="card card-combat">
        <h2>Combat</h2>
        <div class="combat-grid">
          <div class="combat-field">
            <label>Armor Class</label>
            <input type="number" id="armorClass" min="0" value="10" />
          </div>
          <div class="combat-field">
            <label>Initiative</label>
            <input type="number" id="initiative" value="0" />
          </div>
          <div class="combat-field">
            <label>Hit Point Maximum</label>
            <input type="number" id="hitPointMax" min="1" value="10" />
          </div>
          <div class="combat-field">
            <label>Current HP</label>
            <input type="number" id="hitPointCurrent" value="10" />
          </div>
          <div class="combat-field">
            <label>Temp HP</label>
            <input type="number" id="hitPointTemp" min="0" value="0" />
          </div>
          <div class="combat-field">
            <label>Hit Dice</label>
            <input type="text" id="hitDice" placeholder="e.g. 1d8" value="1d8" />
          </div>
          <div class="combat-field">
            <label>Total Hit Dice</label>
            <input type="text" id="hitDiceTotal" placeholder="e.g. 1" value="1" />
          </div>
        </div>
        <div class="death-saves">
          <label>Death Saves</label>
          <div class="death-row">
            <span>Successes</span>
            <input type="number" id="deathSuccesses" min="0" max="3" value="0" />
            <span>Failures</span>
            <input type="number" id="deathFailures" min="0" max="3" value="0" />
          </div>
        </div>
      </section>

      <!-- Proficiency, Speed, Inspiration -->
      <section class="card card-quick-stats">
        <div class="quick-stats-grid">
          <div class="quick-stat"><label>Proficiency Bonus</label><span id="prof-display" class="stat-value">+2</span></div>
          <div class="quick-stat"><label>Speed</label><input type="number" id="speed" min="0" value="30" class="stat-input" /> ft.</div>
          <div class="quick-stat"><label>Inspiration</label><input type="number" id="inspiration" min="0" value="0" class="stat-input" /></div>
        </div>
      </section>

      <!-- Dice roller -->
      <section class="card card-dice">
        <h2>Dice Roller</h2>
        <div class="dice-controls">
          <div class="dice-row">
            <input type="number" id="dice-count" min="1" max="20" value="1" />
            <span>d</span>
            <select id="dice-type">
              <option value="4">4</option>
              <option value="6">6</option>
              <option value="8">8</option>
              <option value="10">10</option>
              <option value="12">12</option>
              <option value="20" selected>20</option>
              <option value="100">100</option>
            </select>
            <span>+</span>
            <input type="number" id="dice-modifier" value="0" />
            <button type="button" id="btn-roll-dice" class="btn btn-primary">Roll</button>
          </div>
          <div class="quick-dice">
            <button type="button" class="quick-roll" data-dice="1d4">d4</button>
            <button type="button" class="quick-roll" data-dice="1d6">d6</button>
            <button type="button" class="quick-roll" data-dice="1d8">d8</button>
            <button type="button" class="quick-roll" data-dice="1d10">d10</button>
            <button type="button" class="quick-roll" data-dice="1d12">d12</button>
            <button type="button" class="quick-roll" data-dice="1d20">d20</button>
            <button type="button" class="quick-roll" data-dice="2d6">2d6</button>
          </div>
        </div>
        <div id="dice-result" class="dice-result"></div>
      </section>

      <!-- Tabbed content -->
      <section class="card card-tabs">
        <div class="tabs-nav">
          <button type="button" class="tab-btn active" data-tab="actions">Actions</button>
          <button type="button" class="tab-btn" data-tab="inventory">Inventory</button>
          <button type="button" class="tab-btn" data-tab="features">Features & Traits</button>
          <button type="button" class="tab-btn" data-tab="background">Background</button>
          <button type="button" class="tab-btn" data-tab="notes">Notes</button>
        </div>
        <div class="tabs-content">
          <div id="tab-actions" class="tab-pane active">
            <textarea id="attacks" rows="5" placeholder="Attacks & spellcasting: Name | Atk Bonus | Damage/Type"></textarea>
          </div>
          <div id="tab-inventory" class="tab-pane hidden">
            <textarea id="equipment" rows="8" placeholder="List equipment…"></textarea>
          </div>
          <div id="tab-features" class="tab-pane hidden">
            <button type="button" id="btn-feature-choices" class="btn btn-ghost btn-sm feature-choices-btn">Manage Feature Choices</button>
            <div id="featuresAuto" class="features-auto"></div>
            <label class="features-custom-label">Additional features & traits</label>
            <textarea id="customFeatures" rows="5" placeholder="Other features, traits, or notes…"></textarea>
          </div>
          <div id="tab-background" class="tab-pane hidden">
            <div class="background-subnav">
              <button type="button" class="bg-sub-btn active" data-bg-filter="all">All</button>
              <button type="button" class="bg-sub-btn" data-bg-filter="background">Background</button>
              <button type="button" class="bg-sub-btn" data-bg-filter="characteristics">Characteristics</button>
              <button type="button" class="bg-sub-btn" data-bg-filter="personality">Personality</button>
            </div>
            <div id="bg-section-background" class="bg-section" data-bg-section="background">
              <h3 class="bg-section-heading">Background</h3>
              <div id="backgroundDisplay" class="background-display"></div>
            </div>
            <div id="bg-section-characteristics" class="bg-section" data-bg-section="characteristics">
              <h3 class="bg-section-heading">Characteristics</h3>
              <div class="characteristics-grid">
                <label><span class="char-label">Alignment</span><input type="text" id="alignment" placeholder="e.g. Chaotic Good" /></label>
                <label><span class="char-label">Gender</span><input type="text" id="bgGender" placeholder="e.g. Male" /></label>
                <label><span class="char-label">Eyes</span><input type="text" id="bgEyes" placeholder="e.g. Sharp Grey" /></label>
                <label><span class="char-label">Size</span><input type="text" id="bgSize" placeholder="e.g. Medium" /></label>
                <label><span class="char-label">Height</span><input type="text" id="bgHeight" placeholder="e.g. 5'7\"" /></label>
                <label><span class="char-label">Faith</span><input type="text" id="bgFaith" placeholder="e.g. Protestant" /></label>
                <label><span class="char-label">Hair</span><input type="text" id="bgHair" placeholder="e.g. Blonde" /></label>
                <label><span class="char-label">Skin</span><input type="text" id="bgSkin" placeholder="e.g. Slightly Tanned" /></label>
                <label><span class="char-label">Age</span><input type="text" id="bgAge" placeholder="e.g. 25" /></label>
                <label><span class="char-label">Weight</span><input type="text" id="bgWeight" placeholder="e.g. 125 lb." /></label>
              </div>
            </div>
            <div id="bg-section-personality" class="bg-section" data-bg-section="personality">
              <h3 class="bg-section-heading">Personality</h3>
              <div class="personality-fields">
                <label class="personality-label">Personality Traits</label>
                <textarea id="bgPersonalityTraits" rows="3" placeholder="Describe your character's personality traits…"></textarea>
                <label class="personality-label">Ideals</label>
                <textarea id="bgIdeals" rows="2" placeholder="What ideals drive your character?…"></textarea>
                <label class="personality-label">Bonds</label>
                <textarea id="bgBonds" rows="2" placeholder="What bonds connect your character to the world?…"></textarea>
                <label class="personality-label">Flaws</label>
                <textarea id="bgFlaws" rows="2" placeholder="What flaws or weaknesses does your character have?…"></textarea>
              </div>
            </div>
          </div>
          <div id="tab-notes" class="tab-pane hidden">
            <div class="notes-sections">
              <label class="notes-label">Organizations</label>
              <textarea id="notesOrganizations" rows="2" placeholder="Organizations your character belongs to…"></textarea>
              <label class="notes-label">Allies</label>
              <textarea id="notesAllies" rows="2" placeholder="Notable allies and contacts…"></textarea>
              <label class="notes-label">Enemies</label>
              <textarea id="notesEnemies" rows="2" placeholder="Enemies and rivals…"></textarea>
              <label class="notes-label">Backstory</label>
              <textarea id="notesBackstory" rows="6" placeholder="Your character's backstory…"></textarea>
              <label class="notes-label">Other</label>
              <textarea id="notesOther" rows="2" placeholder="Other notes…"></textarea>
            </div>
          </div>
        </div>
      </section>

      </div>
    </main>

    <!-- Auth modal (login / register) -->
    <div id="auth-modal" class="modal hidden">
      <div class="modal-content auth-modal-content">
        <h3 id="auth-modal-title">Log in</h3>
        <div id="auth-error" class="auth-error hidden"></div>
        <form id="auth-form">
          <label>Username <input type="text" id="auth-username-input" autocomplete="username" required /></label>
          <label id="auth-email-row" class="hidden">Email <input type="email" id="auth-email-input" autocomplete="email" placeholder="you@example.com" /></label>
          <label>Password <input type="password" id="auth-password-input" autocomplete="current-password" required /></label>
          <div class="auth-form-actions">
            <button type="submit" id="auth-submit" class="btn btn-primary">Log in</button>
            <button type="button" id="auth-switch-mode" class="btn btn-ghost">Create an account</button>
            <button type="button" id="auth-cancel" class="btn btn-ghost">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Feature choices modal -->
    <div id="feature-choices-modal" class="modal hidden">
      <div class="modal-content feature-choices-modal-content">
        <h3>Feature Choices</h3>
        <p class="feature-choices-hint">Make choices for features that require them at your level.</p>
        <div id="feature-choices-list"></div>
        <button type="button" id="btn-close-feature-choices" class="btn btn-ghost">Close</button>
      </div>
    </div>

    <!-- Manage modal (character info) -->
    <div id="manage-modal" class="modal hidden">
      <div class="modal-content manage-modal-content">
        <h3>Manage Character</h3>
        <div class="info-grid">
          <label>Character Name <input type="text" id="name" placeholder="—" /></label>
          <label>Race <select id="race"><option value="">—</option></select><input type="text" id="raceCustom" class="custom-input hidden" placeholder="Custom race" /></label>
          <label>Class <select id="class"><option value="">—</option></select><input type="text" id="classCustom" class="custom-input hidden" placeholder="Custom class" /></label>
          <label>Level <input type="number" id="level" min="1" max="20" value="1" /></label>
          <label>Background <select id="background"><option value="">—</option></select><input type="text" id="backgroundCustom" class="custom-input hidden" placeholder="Custom background" /></label>
          <label>Player Name <input type="text" id="playerName" placeholder="—" /></label>
          <label>Experience Points <input type="number" id="experiencePoints" min="0" value="0" /></label>
          <label>Proficiency Bonus <input type="number" id="proficiencyBonus" value="2" /></label>
        </div>
        <div class="manage-actions">
          <button type="button" id="btn-delete-character" class="btn btn-ghost btn-danger" title="Delete this character from the server">Delete character</button>
          <button type="button" id="btn-close-manage" class="btn btn-ghost">Close</button>
        </div>
      </div>
    </div>

    <!-- Reference database modal -->
    <div id="reference-modal" class="modal hidden">
      <div class="modal-content reference-modal-content">
        <h3>Reference Database</h3>
        <div class="reference-subnav">
          <button type="button" class="ref-sub-btn active" data-ref-cat="spells">Spells</button>
          <button type="button" class="ref-sub-btn" data-ref-cat="equipment">Equipment</button>
          <button type="button" class="ref-sub-btn" data-ref-cat="magicitems">Magic Items</button>
          <button type="button" class="ref-sub-btn" data-ref-cat="rules">Rules</button>
        </div>
        <div class="reference-search">
          <input type="text" id="reference-search-input" placeholder="Search…" />
        </div>
        <div id="reference-spell-filters" class="spell-filters hidden">
          <label>
            <span class="spell-filter-label">School</span>
            <select id="ref-spell-filter-school">
              <option value="">All Schools</option>
              <option value="Abjuration">Abjuration</option>
              <option value="Conjuration">Conjuration</option>
              <option value="Divination">Divination</option>
              <option value="Enchantment">Enchantment</option>
              <option value="Evocation">Evocation</option>
              <option value="Illusion">Illusion</option>
              <option value="Necromancy">Necromancy</option>
              <option value="Transmutation">Transmutation</option>
            </select>
          </label>
          <label>
            <span class="spell-filter-label">Class</span>
            <select id="ref-spell-filter-class">
              <option value="">All Classes</option>
              <option value="bard">Bard</option>
              <option value="cleric">Cleric</option>
              <option value="druid">Druid</option>
              <option value="paladin">Paladin</option>
              <option value="ranger">Ranger</option>
              <option value="sorcerer">Sorcerer</option>
              <option value="warlock">Warlock</option>
              <option value="wizard">Wizard</option>
              <option value="artificer">Artificer</option>
            </select>
          </label>
          <label>
            <span class="spell-filter-label">Level</span>
            <select id="ref-spell-filter-level">
              <option value="">All Levels</option>
              <option value="0">Cantrip</option>
              <option value="1">1st</option>
              <option value="2">2nd</option>
              <option value="3">3rd</option>
              <option value="4">4th</option>
            </select>
          </label>
        </div>
        <div class="reference-content">
          <div id="ref-list" class="ref-list"></div>
          <div id="ref-detail" class="ref-detail"></div>
        </div>
        <p class="reference-credit">Reference data from Open5e (no account required).</p>
        <button type="button" id="btn-close-reference" class="btn btn-ghost">Close</button>
      </div>
    </div>

    <!-- Load modal -->
    <div id="load-modal" class="modal hidden">
      <div class="modal-content">
        <h3>Load Character</h3>
        <ul id="character-list" class="character-list"></ul>
        <button type="button" id="btn-close-load" class="btn btn-ghost">Close</button>
      </div>
    </div>
    </div>
  </div>

  <script src="data-options.js"></script>
  <script src="builder-data.js"></script>
  <script src="descriptions.js"></script>
  <script src="feature-choices.js"></script>
  <script src="app.js"></script>
</body>
</html>
